---
title: Laraval-後台管理系統與前台顯示-03
date: 2024-06-12 08:54:04
tags: 
    - 職訓
    - Laravel
categories: 
    - [職訓, Laravel]
    - Laravel
description: QA頁面及商品簡介頁面製作
---

#### 上半場

##### QA 功能製作

1. 新建前台Controller

```Terminal Terminal輸入
php artisan make:control front/QaController
```

2. 新建後台Controller

```Terminal Terminal輸入
php artisan make:control Admin/AdminQaController
```

3. 至AdminQaController新增方法

```php 新增QA資料
class AdminQaController extends Controller
{
    public function list(){
        $list = Qa::get();
        return view("admin.qa.list", compact("list"));
    }

    public function add(){
        return view("admin.qa.add");
    }

    public function insert(Request $req){

        $answer = $req->answer;
        if(!empty($answer)){
            // str_replace:取代字串
            // 將輸入框的換行轉換為網頁的換行
            $answer = str_replace("\n","<br/>",$answer);
        }
        $qa = new Qa();
        $qa->question = $req->question;
        $qa->content = $answer;
        $qa->save();

        Session::flash("message", "已新增");
        return redirect("/admin/qa/list");
    }


    public function edit(Request $req){
        $qa = Qa::find($req->id);
        return view("admin.qa.edit",compact("qa"));
    }

    public function update(Request $req){

        $content = $req->content;
        if(!empty($content)){
            // str_replace:取代字串
            // 將輸入框的換行轉換為網頁的換行
            $content = str_replace("\n","<br/>", $content);
        }
        $qa = Qa::find($req->id);
        $qa->question = $req->question;
        $qa->content = $content;
        $qa->update();

        Session::flash("message", "已修改");
        return redirect("/admin/qa/list");
    }

    public function delete(Request $req){
        (new Qa())->deleteQa($req->id);

        Session::flash("message", "已刪除");
        return redirect("/admin/qa/list");
    }

}
```

4. 新建 admin/qa 資料夾

5. 新增 add.blade, edit.blade, list.blade 三個php檔案

6. 將notice/list.blade 內容複製貼上到qa/list.blade

7. 修改其中內容

```php 

@extends("admin.app")
@section("title","Q&A")     // 改標題
@section("content")
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="row">
                        <div class="col-1">
                            <a href="add" class="btn btn-primary">新增</a>
                        </div>
                        <div class="col-1">
                            <a href="javascript:doDelete('list')" class="btn btn-danger">刪除</a>
                        </div>
                    </div>
                </div>
            </div>
            <form id="list" name="list" method="post" action="/admin/qa/delete">    // 改方法
                {{ csrf_field() }}
                <table class="table table-border border">
                    <thead>
                        <tr class="table table-warning">
                            <th class="col-1 text-center align-top">
                                <input type="checkbox" class="form-check-input" id="all">
                            </th>
                            <th class="col-5 text-center">問題</th>     // 改checkBox內容
                            <th class="col-4 text-center">回答</th>
                            <th class="col-2 text-center">修改</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($list as $data)
                        <tr>
                            <td class="col-1 text-center">
                                <input type="checkbox" name="id[]" class="form-check-input chk" value="{{ $data->id }}">
                            </td>
                            <td class="col-5 text-left">{{ $data->question }}</td>
                            <td class="col-4 text-left">{!! $data->content !!}</td>     // 修改抓取方式
                            <td class="col-2 text-center">
                                <a href="edit/{{ $data -> id }}" class="btn btn-success text-white">修改</a>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </form>
        </div>
    </div>
</div>
@endsection


```

8. 將notice/add.blade 內容複製貼上到qa/add.blade

9. 修改其中內容

```php
@extends("admin.app")
@section("title","新增Q&A")
@section("content")
<div class="container">
    <div class="row">
        <div class="card col-12">
            <div class="card-header">
                <a href="list" class="btn btn-secondary">回上頁</a>
            </div>
        </div>
    </div>
        <form method="post" action="insert">
            {{ csrf_field() }}
            <div class="row">
                <label class="col-form-lable col-3 text-right">問題</label>     // 標題改成問題
                <div class="col-6">
                    <input type="text" class="form-control" name="question" required>   // name記得修改
                </div>
            </div>
            <div class="row mt-3">
                <label class="col-form-lable col-3 text-right">回答</label>     // 新增回答，輸入框屬性是textarea
                <div class="col-6">
                    <textarea type="text" class="form-control" name="answer" rows="3" required></textarea> 
                </div>
            </div>
            <div class="card-body text-center mt-3">
                <button class="btn btn-primary" type="submit">確定</button>
            </div>
        </form>
</div>
@endsection
```

{% note success %}

`{!! $data->content !!}`: 前後大括號和雙驚嘆號代表以html的抓取
因為資料表裡的content內容包含`"<br>"`，直接用html顯示才不會出現

{% endnote %}

10. 將notice/edit.blade 內容複製貼上到qa/edit.blade

```php
@extends("admin.app")
@section("title","QA修改內容")
@section("content")
<div class="container">
    <div class="row">
        <div class="card col-12">
            <div class="card-header">
                <a href="../list" class="btn btn-secondary">回上頁</a>
            </div>
        </div>
    </div>
        <form method="post" action="../update">
            <input type="hidden" name="id" value="{{ $qa->id }}">
            {{ csrf_field() }}
            <div class="row">
                <label class="col-form-lable col-3 text-right">問題</label>
                <div class="col-9">
                    <input type="text" class="form-control" name="question" value="{{ $qa->question }}" required>
                </div>
            </div>
            <div class="row">
                <label class="col-form-lable col-3 text-right">回答</label>
                <div class="col-9">
                    <textarea type="text" class="form-control" name="content" required>{!! str_replace("<br/>","\n",$qa->content) !!}</textarea>
                </div>
            </div>
            <div class="card-body text-center mt-3">
                <button class="btn btn-primary" type="submit">確定</button>
            </div>
        </form>
</div>
@endsection
```

{% note success %}

`<textarea>`和前述`list`相同原因，裡面加入`str_replace("<br/>","\n",$qa->content)` 將`<br>`轉換成`\n`
讓`<textarea>`可以正常顯示

`name`和`title`記得修改

{% endnote %}

11. 這裡應該要回去Controller寫方法，不過前面已經都貼上去了

```php AdminQaController_修改&更新
public function edit(Request $req){
    $qa = Qa::find($req->id);
    return view("admin.qa.edit",compact("qa"));
}

public function update(Request $req){

    $content = $req->content;
    if(!empty($content)){
        // str_replace:取代字串
        // 將輸入框的換行轉換為網頁的換行
        $content = str_replace("\n","<br/>", $content);
    }
    $qa = Qa::find($req->id);
    $qa->question = $req->question;
    $qa->content = $content;
    $qa->update();

    Session::flash("message", "已修改");
    return redirect("/admin/qa/list");
}
```

12. 刪除功能要去`Model`和`Controller`

```php
// Model的部分
public function deleteQa($ids)
{
    self::wherein("id", $ids)->delete();
}


// Controller的部分
public function delete(Request $req){
    (new Qa())->deleteQa($req->id);

    Session::flash("message", "已刪除");
    return redirect("/admin/qa/list");
}
```

13. 來做前台吧！先到QaController新增方法

```php
class QaController extends Controller
{
    public function list(){
        $list = Qa::all();
        
        return view("front.qa",compact("list"));
    }
}
```

14. 然後建個前台頁面`front/qa.blade`，將原本檔案內容複製貼上