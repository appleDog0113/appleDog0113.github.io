---
title: Laravel-05
date: 2024-06-27 08:19:55
tags: 
    - 職訓
    - Laravel
categories: 
    - [職訓, Laravel]
    - Laravel
description: pro頁面製作、prize頁面製作
---

##### pro.blade 加圖片

```php pro.blade

  </div><!--w-100-->
  <div class="gw img-size-50 text-center pb-5">
    @if(!empty($list) && sizeof($list)>0)
      @if(!empty($list[0]->photo))
      <img src="/images/product/{{ $list[0]->photo }}" alt="">
      @endif
    @endif
  </div><!--img-wrap-->
</div><!--col-->

@endsection
```

{% note info %}
判斷撈進來的資料是否為空
非為空就丟進`img`的路徑裡
{% endnote %}

```php 在這邊增加onclick屬性讓畫面不會跳動（兩種寫法）
@if($cnt == 1)
    <a href="#" onclick="getPhoto('{{ $data->id }}');return false" class="active">產品{{$data->title}}</a>
@else
    <a href="javascript:getPhoto('{{ $data->id }}')">產品{{$data->title}}</a>
@endif
```

##### 從後端要資料

最前面加上這段

```php pro.blade
<script>
  function getPhoto(id) {
    $.ajax({
      url:"/Product/getPhoto",
      type: "GET",
      data:{
        id: id,
        _token: "{{ csrf_token() }}"
      },
      success: function(msg){
        $('#photo').attr("src","/images/product/" +msg);
      }
    });
  }
</script>
```

下方圖片應該就會跑了！

##### 突發！整理Route

原本的web裡太多東西了，分類整理一下吧

1. Add routes/admin, routes/front
2. /admin 新增index, admin, notice, pro, qa.php

```php index.php
<?php
use Illuminate\Support\Facades\Route;
require "admin.php";
require "notice.php";
require "pro.php";
require "qa.php";
```

在首頁請求其他routes
進資料夾會自動讀取

```php admin.php
<?php

use App\Http\Controllers\Admin\AdminController;
use Illuminate\Support\Facades\Route;

Route::group(["prefix" => "admin"], function(){
    Route::get("/",[AdminController::class, "login"]);
    Route::post("doLogin",[AdminController::class, "doLogin"]);
    Route::get("home",[AdminController::class, "home"])->middleware("manager");
});
```

其他照搬內容，將web.php的檔案內容複製貼上過去
use要記得引用！！！

3. 原本的web內容：

```php web
<?php

require "admin/index.php";
require "front/index.php";
```

直接請求index.php即可

##### 快速地做出prize頁面

1. 後台Admin新增各種頁面從pro複製貼上
2. 前台front從pro各種複製貼上
3. Route 新增各種東西
4. mySQL 新增table prize
5. 新增路徑 resources\views\admin\prize
   1. 在路徑下新增add, edit, list.blade
   2. 複製pro的內容，調整排版，改路徑
6. PrizeController
   ```php
    class PrizeController extends Controller
    {
        public function index(){
            
            $list=Prize::get();

            return view("front.prize", compact("list"));
        }

        public function getPhoto(Request $req){

            $data = Prize::find($req->id);
            return response()->json(["photo"=>$data->photo,"content"=>$data->content,"num"=>$data->num]);
            // 回傳json格式
            // response()->回傳到瀏覽器
        }

    }
   ```
7. /front/prize.blade

    script改內容（跟pro不一樣）
    除了換成JSON格式外
    `$("#content").html(msg.content + "，共"+msg.num+"名");`

   ```php
    function getPhoto(id) {
        $.ajax({
            url: "/prize/getPhoto",
            type: "GET",
            dataType: "json",
            data: {
            id: id,
            _token: "{{ csrf_token() }}"
            },
            success: function(msg) {
            $('#photo').attr("src", "/images/prize/" + msg.photo);
            $("#title" + id).addClass("active");
            $("#title" + activeId).removeClass("active");
            $("#content").html(msg.content + "，共"+msg.num+"名");
            activeId = id;
            }
        });
    }
   ```

    調整content出現的地方

   ```php
  <div class="gw img-wrap img-auto pb-5 text-center mt-3">
    @if(!empty($list) && sizeof($list)>0)
    <h3 class="sub-title" id="content">{{$list[0]->content}}，共{{$list[0]->num}}名</h3>
        @if(!empty($list[0]->photo))
        <img id="photo" class="img-thumbnail rounded-4 bg-cover shadow" src="/images/prize/{{ $list[0]->photo }}">
        @endif
    @endif
   ```

{% note info %}
然後他就會動了！！！
{% endnote %}