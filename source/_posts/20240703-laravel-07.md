---
title: "Laravel-07-專案二: 賣茶網"
date: 2024-07-03 08:32:48
tags:
  - 職訓
  - Laravel
categories:
  - [職訓, Laravel]
  - Laravel
description: 建立新專案，並製作後台登入頁面及登入判斷功能
---

#### 新專案：賣茶網

1. 建立新專案

   終端機輸入
   `composer creat-project laravel/laravel=8.* 202407`

2. 開啟新資料夾 `202407`

3. 結構

   - `app\Http\Controllers\Controller.php`
     所有 Controller 都在這裡

   - `app\Http\Middleware\`
     中繼資料，包含驗證功能或者預載資料都在這裡

   - Model>>放資料表
   - public>> 放各種公開的東西，ex. css, js, images...
   - `resources\views\` 網頁碼放這邊
   - `Routes`
     - api.php：給外部呼叫時寫在這裡
     - web.php：自己呼叫地放在這邊
   - `.env`
     - 環境設定，**非常重要的東西**

4. 這次用`MariaDB`, `.env`要修改

   ```php
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3307
   DB_DATABASE=202407
   DB_USERNAME=root
   DB_PASSWORD=
   ```

   {% note info %}
   只要使用超過一個以上的資料表並且會使用交易功能（不是`join`），要用`MariaDB`

   `join`只能控制一個資料表，有時候會動到兩個資料表

   > 比如下訂單：
   >
   > 1. 訂單資料->DB1
   > 2. 訂單明細->DB2
   >    這兩個要同時連動，就要使用`MariaDB`

   `MariaDB是SQL的女兒寫的，哈哈`

   {% endnote %}

5. 建立資料庫

##### 建立後台登入頁面

1. 新增資料表`news_type`
    這是我們要製作的第一個頁面「最新消息」

2. 項目：
    - id
    - title
3. 新建`Model`
    終端機輸入：`php artisan make:model News/NewsType`

4. `app\Models\News\NewsType.php`
    建立新方法

    ```php
    class NewsType extends Model
    {
        public $timestamps = false;
        protected $table = "news_type";
        protected $primaryKey = "id";
        protected $fillable = [
            "id",
            "title"
        ];

        public function delItem($id){
            self::wherein("id",$id)->delete();
        }
    }
    ```

5. 將上一個專案`/public`底下的`/css`、`/js` 複製過來，不用複製 `/front`

    因為之前的 dashboard 是複製過來的，所以再複製一次就行了

6. 新建 Controller

    `php artisan make:controller Admin/AdminController`

    ```php
     class AdminController extends Controller
     {
         public function index(){
             return view("admin.index");
         }
     }
    ```

7. 新建資料表`manager`

    - id: /INT/PRIMARY/A_I
      - A_I: 自動編號
    - userId: VARCHAR/10/Null
    - pwd: VARCHAR/10/Null

    {% note info %}
    資料庫管理工具：
    mySQL
    Toad
    DBeaver
    {% endnote %}

8. 新建`Model:Admin/Manager`

    ```php
    class Manager extends Model
    {
        public $timestamps = false;
        protected $table = "manager";
        protected $primaryKey = "id";
        protected $fillable = [
            "id",
            "userId",
            "pwd"
        ];
    }
    ```

9. 建立路由`Route`

    - 在`/Route`新建資料夾做分類

      - `/admin`: 後台

        - `routes\admin\index.php`建立檔案

        - ```php 內容
             <?php
                 use App\Http\Controllers\Admin\AdminController;
                 use Illuminate\Support\Facades\Route;

                 Route::get("/admin",[AdminController::class,"index"]);
          ```

      - `/front`: 前台
        - 步驟同上

10. 製作驗證碼功能: `captcha`

    - google: laravel captcha
    - Terminal 輸入: `composer require mews/captcha`開始安裝
    - 到`vendor\mews\captcha\config\captcha.php`修改相關參數設定

11. 開始建立前台網頁

    - 新增`resources\views\admin\index.blade.php`
    - 內容：

      ```php
          <!DOCTYPE html>
          <html lang="zh-TW">

              <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>後台管理系統</title>
                  <link rel="stylesheet" href="/css/bootstrap.min.css">
              </head>

              <body>
                  <div class="container">
                      <div class="card mt-3">
                          <div class="card-header">
                              <form action="/admin/login" method="post"  onsubmit="return doCheck()>
                                {{ csrf_field() }}
                              <div class="row mt-3">
                                  <div class="col-4 col-sm-4 col-md-3 col-lg-2 text-center">帳號</div>
                                  <div class="col-8 col-sm-5 col-md-4 col-lg-3 text-center">
                                      <input type="text" name="userID" class="form-control" value="{{ old('userId') }}">
                                  </div>
                              </div>
                              <div class="row mt-3">
                                  <div class="col-4 col-sm-4 col-md-3 col-lg-2 text-center">密碼</div>
                                  <div class="col-8 col-sm-5 col-md-4 col-lg-3 text-center">
                                      <input type="password" name="pwd" class="form-control" value="{{ old('pwd') }}">
                                  </div>
                              </div>
                              <div class="row mt-3">
                                  <div class="col-4 col-sm-4 col-md-3 col-lg-2 text-center">驗證碼</div>
                                  <div class="col-8 col-sm-5 col-md-4 col-lg-3 text-center">
                                      <input type="text" name="code" class="form-control">
                                  </div>
                                  <div class="col-8 col-sm-5 col-md-4 col-lg-3 text-center">
                                      <img src="/captcha/flat" alt="" onclick="this.src='/captcha/flat?'+Math.random()" style="cursor: pointer">
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-5 mt-3 text-center">
                                      <button type="submit" class="btn btn-primary">確定</button>
                                  </div>
                              </div>
                              </form>
                          </div>
                      </div>
                  </div>
              </body>
          </html>
      ```

    {% note info %}

    1. 保留原本輸入的資料：

        ```php
        value="{{ old('pwd') }}"
        ```

    使用`old()`

    2. 驗證碼的部分

        ```php
            <div class="row mt-3">
                <div class="col-4 col-sm-4 col-md-3 col-lg-2 text-center">驗證碼</div>
                <div class="col-8 col-sm-5 col-md-4 col-lg-3 text-center">
                    <input type="text" name="code" class="form-control">
                </div>
                <div class="col-8 col-sm-5 col-md-4 col-lg-3 text-center">
                    <img src="/captcha/flat" alt="" onclick="this.src='/captcha/flat?'+Math.random()" style="cursor: pointer">
                </div>
            </div>
        ```

        `style="cursor: pointer`: 滑鼠移至會變成手型點擊圖片

    {% endnote %}

12. 登入功能

    - 總之再突發整理一下`Route`
      - 新增 /admin/admin.php

      - ```php
            <?php

            use App\Http\Controllers\Admin\AdminController;
            use Illuminate\Support\Facades\Route;

            Route::group(["prefix"=>"admin"],function(){
                Route::get("/",[AdminController::class,"index"]);
                Route::post("/login",[AdminController::class,"login"]);
            });
        ```

      - index.php記得要require

    - `AdminController`新增`Login`的方法

        ```php
        public function login(Request $req){

            if(captcha_check($req->code) == false){

                return back()->withInput()->withErrors(["code"=>"驗證碼錯誤"]);

            }

        }
        ```

        {% note info%}

        `back()`: 退回原頁面
        `withInput()`: 保留輸入資料
        `withErrors(["code"=>"驗證碼錯誤"])`: 顯示錯誤碼

        {% endnote %}

    - 回到`index.blade`，增加驗證碼跳出錯誤提示

        ```php
        <div class="col-4 col-sm-4 col-md-3 col-lg-2 text-center">驗證碼</div>
        <div class="col-4 col-sm-4 col-md-3 col-lg-2 text-center">
            <input type="text" name="code" class="form-control">
            @if ($errors->has("code"))
                <div class="text-danger">{{ $errors->first("code") }}</div>
            @endif
        ```

        新增`@if`那串判斷式

    - 增加JS語法

        ```php
        <script>
            function doCheck() {
                var code = document.getElementById("code").value;
                if (code == "") {

                    alert("請輸入驗證碼");
                    return false;
                }
                return true;
            }
        </script>
        ```

    {% note success %}
    到這邊按下去應該就會動了
    {% endnote %}
