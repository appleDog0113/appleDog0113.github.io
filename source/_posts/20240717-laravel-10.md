---
title: "Laravel-10-專案二: 賣茶網"
date: 2024-07-17 08:29:52
tags:
  - 職訓
  - Laravel
categories:
  - [職訓, Laravel]
  - Laravel
description: "News頁面收尾、製作About頁面後台、CRUD製作"
---

### 製作最新消息頁面

#### news前台頁面製作

##### News Model修改

> whereRaw('1=1'), 永遠成立讓選單可以使用
查詢功能經常使用，讓後面的AND、OR等條件可以正常使用

```php app\Models\News\News.php
public function getDataList($year, $typeId){

    $sql = self::whereRaw("1 = 1");

    ...

}
```

##### 新增detail.blade頁面

複製原始檔案的內容
修改頁面引入

```php resources\views\front\news\detail.blade.php
@extends("front.comm")
@section("content")
<div data-scroll-watch="" class="fade_in title">
    <div class="breadcrumbs"><a href="/">首頁</a> / <a href="/news">最新消息</a> / <span>{{$news->title}}</span></div>
</div>
<div class="news_detail">
    <div class="content">
        <div class="date">{{$news->dates}}</div>
        <h3 class="main_title">{{$news->title}}</h3>
        <p class="subtitle">{{$news->subtitle}}</p>
        @if(!empty($news->photo))
        <img src="/images/news/{{ $news->photo }}">
        @endif
        <p class="context">{!! $news->content !!}</p>
    </div>
</div>
@endsection
```

### 製作關於我們頁面

#### About後台頁面製作

網頁分析：將不同類別分出資料表
讓各類別資料可以自行帶入內容

這次會實作更改語系功能

##### 新增資料表about_title

資料表備註：**關於我們的title**

|  名稱   | 資料類型 | 長度/值 | Null  |  A.I  | 備註                        |
| :-----: | :------: | :-----: | :---: | :---: | --------------------------- |
|   id    |   int    |    -    |   -   |   O   | -                           |
| typeId  |   int    |    -    |   O   |   -   | 1.檔頭 2.關於 3.優勢 4.記事 |
|  title  | varchar  |   20    |   O   |   -   | 標題                        |
| content | varchar  |   100   |   O   |   -   | 內容                        |
|   lan   |   int    |    -    |   O   |   -   | 語系                        |

##### 新增資料表about_type

資料表備註：**關於我們的auto_type**

建立目的是為了自動化選取帶入

| 名稱  | 資料類型 | 長度/值 | Null  |  A.I  | 備註 |
| :---: | :------: | :-----: | :---: | :---: | ---- |
|  id   |   int    |    -    |   -   |   O   | -    |
| title | varchar  |   10    |   O   |   -   | 標題 |

直接建立about_title備註的四個內容
id不用輸入，自動產生

|   id    | title    |
| :-----: | -------- |
| 1(auto) | 介紹     |
| 2(auto) | 關於我們 |
| 3(auto) | 優勢     |
| 4(auto) | 紀事     |

##### 新增資料表lan

資料表備註：**語系**

| 名稱  | 資料類型 | 長度/值 | Null  |  A.I  | 備註 |
| :---: | :------: | :-----: | :---: | :---: | ---- |
|  id   |   int    |    -    |   -   |   O   | -    |
| title | varchar  |   10    |   O   |   -   | 語系 |

建立內容

|   id    | title |
| :-----: | ----- |
| 1(auto) | 中文  |
| 2(auto) | 英文  |

##### 建立Model

###### 指令建立

```terminal
php artisan make:model AboutTitle
php artisan make:model AboutType
```

###### 內容

```php app\Models\About\AboutTitle.php
namespace App\Models\About;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\DB;

class AboutTitle extends Model
{
    public $timestamps = false;
    protected $table = "about_title";
    protected $primaryKey = "id";
    protected $fillable = [
        "id",
        "lan",
        "typeId",
        "title",
        "content"
    ];

    // 建立一張暫時的新資料表，裡面包含about_title的全部和about_type.title
    // about_type.title 取別名為 typeName
    // 將about_title.typeId和about_type.id JOIN(關聯)
    // about_title.typeId = about_type.id
    // 可以由about_title.typeId取得about_type.title的內容
    public function getList(){
        $list = DB::table("about_title AS a")
            ->selectRaw("a.*, b.title AS typeName")
            ->join("about_type AS b", "a.typeId", "b.id")
            ->get();

        return $list;
    }
}
```

```php app\Models\About\AboutType.php
namespace App\Models\About;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class AboutTitle extends Model
{
    public $timestamps = false;
    protected $table = "about_type";
    protected $primaryKey = "id";
    protected $fillable = [
        "id",
        "title"
    ];
}
```

##### 建立Controller

```terminal
php artisan make:controller Admin/About/AboutTitleController
```

```php app\Http\Controllers\Admin\About\AboutTitleController.php
namespace App\Http\Controllers\Admin\About;

use App\Http\Controllers\Controller;
use App\Models\About\AboutTitle;
use Illuminate\Http\Request;

class AboutTitleController extends Controller
{
    public function list(){
        $list = (new AboutTitle())->getList();
        return view("admin.about.title.list", compact("list"));
    }
}

```

##### 建立views

從Controller裡Ctrl+右鍵點擊建立比較快
也可以先建好資料夾:`/about/about`、`/about/advance`、`/about/events`、`/about/title`

###### list.blade

現在只有`/admin/about/title/list.blade.php`
從`/news/list.blade` 複製修改

```php resources\views\admin\about\title\list.blade.php
@extends("admin.app")
@section("title","關於我們：標題管理")
@section("content")
<link rel="stylesheet" href="/css/lightbox.min.css">
<script src="/js/lightbox.min.js"></script>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <a href="add" class="btn btn-primary">新增</a>
                <a href="javascript:doDelete('list')" class="btn btn-danger mx-3">刪除</a>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <form name="list" id="list" action="delete" method="post">
            {{ csrf_field() }}
            <table class="table border border-info border-bottom">
                <tr class="table-info text-bold">
                    <td class="col-1 text-center">
                        <input type="checkbox" name="all" id="all" class="form-check-input">
                    </td>
                    <td class="col-2 text-center">類別</td>
                    <td class="col-2 text-center">標題</td>
                    <td class="col-5 text-center">內容</td>
                    <td class="col-1 text-center">修改</td>
                </tr>
                @foreach($list as $data)
                <tr>
                    <td class="text-center align-content-center">
                        <input type="checkbox" name="id[]" id="id[]" class="form-check-input chk" value="{{ $data->id }}">
                    </td>
                    <td class="text-center align-content-center">{{ $data->typeName }}</td>
                    <td class="text-center align-content-center">{{ $data->title }}</td>
                    <td class="text-center align-content-center">{!! $data->content !!}</td>
                    <td class="text-center align-content-center">
                        <a href="edit/{{ $data->id }}" class="btn btn-success">修改</a>
                    </td>
                </tr>
                @endforeach
            </table>
        </form>
    </div>
</div>
@endsection
```

###### menu 修改

總之自己調整一下

###### 建立add.blade 新增頁面

複製過來改一改

```php resources\views\admin\about\title\add.blade.php
@extends("admin.app")
@section("title","新增關於我們")
@section("content")
<link rel="stylesheet" href="/css/admin/ckeditor.css">

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <a href="../title/list" class="btn btn-info">回上頁</a>
            </div>
            <div class="card-body">
                <form method="post" action="insert" enctype="multipart/form-data">
                    {{ csrf_field() }}
                    <div class="row mt-3">
                        <label class="col-2 text-end form-label">類別</label>
                        <div class="col-2">
                            <select name="typeId" id="typeId" class="form-control text-center" required>
                                <option value="" disabled>---請選擇類別---</option>
                                @foreach($list as $data)
                                <option value="{{ $data->id }}">{{ $data->title }}</option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <label class="col-2 text-end form-label">標題</label>
                        <div class="col-6">
                            <input type="text" class="form-control" name="title" id="title" required>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <label class="col-2 text-end form-label">內容</label>
                        <div class="col-10">
                            <textarea class="form-control editor" name="content" id="editor" rows="3em"></textarea>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-10 text-center">
                            <button type="submit" class="btn btn-primary">儲存</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/41.1.0/super-build/ckeditor.js"></script>
<script src="/js/admin/editor.js"></script>
@endsection
```

###### Controller 調整

```php
public function add(){
    // 取得可以新增的類別（尚未被新增的類別）
    $list = (new AboutType())->getList();
    return view("admin.about.title.add", compact("list"));
}

public function insert(Request $req){

    $content = $req -> content;
    if(!empty($content)){
        // 將換行符號做轉換
        $content = str_replace("\n","<br/>",$content);
    }

    $title = new AboutTitle();
    $title->typeId = $req->typeId;
    $title->title = $req->title;
    $title->content = $req->content;
    $title->save();

    Session::flash("message", "已新增");
    return redirect("/admin/about/title/list");
}

```

###### 建立edit.blade 修改頁面

變數名稱要記得更改
`$list=>$about`之類的
類別不給修改，直接刪除欄位即可

```php
@extends("admin.app")
@section("title","修改關於我們")
@section("content")
<link rel="stylesheet" href="/css/admin/ckeditor.css">

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <a href="../list" class="btn btn-info">回上頁</a>
            </div>
            <div class="card-body">
                <form method="post" action="../update" enctype="multipart/form-data">
                    <input type="hidden" name="id" value="{{ $about->id}}">
                    {{ csrf_field() }}
                    <div class="row mt-3">
                        <label class="col-2 text-end form-label">標題</label>
                        <div class="col-6">
                            <input type="text" class="form-control" name="title" id="title" value="{{$about->title}}" required>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <label class="col-2 text-end form-label">內容</label>
                        <div class="col-6">
                            <textarea class="form-control editor" name="content" id="editor">{!! $about->content !!}</textarea>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-10 text-center">
                            <button type="submit" class="btn btn-primary">儲存</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/41.1.0/super-build/ckeditor.js"></script>
<script src="/js/admin/editor.js"></script>
@endsection
```

###### 刪除功能 Controller

```php
public function delete(Request $req){

    if(!empty($req->id)){
        foreach($req->id as $id){
            $about = AboutTitle::find($id);
            $about -> delete();
        }
    }

    Session::flash("message", "已刪除");
    return redirect("/admin/about/title/list");
}
```

###### list.blade頁面調整

```php
@if (empty($list) || sizeof($list)<4)
    <a href="add" class="btn btn-info">新增</a>
@endif
```

新增按鈕要類別為空，或者類別數量<4才會出現

###### 完整版

```php
@extends("admin.app")
@section("title","關於我們：標題管理")
@section("content")

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
            @if (empty($list) || sizeof($list)<4)
                <a href="add" class="btn btn-info">新增</a>
            @endif
                <a href="javascript:doDelete('list')" class="btn btn-danger mx-3">刪除</a>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <form name="list" id="list" action="delete" method="post">
            {{ csrf_field() }}
            <table class="table border border-info border-bottom">
                <tr class="table-info text-bold">
                    <td class="col-1 text-center">
                        <input type="checkbox" name="all" id="all" class="form-check-input">
                    </td>
                    <td class="col-1 text-center">類別</td>
                    <td class="col-2 text-center">標題</td>
                    <td class="col-5 text-center">說明</td>
                    <td class="col-2 text-center">修改</td>
                </tr>
                @foreach($list as $data)
                <tr>
                    <td class="text-center align-content-center">
                        <input type="checkbox" name="id[]" id="id[]" class="form-check-input chk" value="{{ $data->id }}">
                    </td>
                    <td class="text-center align-content-center">{{ $data->typeName }}</td>
                    <td class="text-center align-content-center">{{ $data->title }}</td>
                    <td class="text-start align-content-center">{!! $data->content !!}</td>
                    <td class="text-center align-content-center">
                        <a href="edit/{{ $data->id }}" class="btn btn-primary ">修改</a>
                    </td>
                </tr>
                @endforeach
            </table>
        </form>
    </div>
</div>
@endsection
```

#### About 前台製作

##### 建立Controller

```terminal
php artisan make:controller Front/FrontAboutController
```

###### 內容

```php
namespace App\Http\Controllers\Front;

use App\Http\Controllers\Controller;
use App\Models\About\AboutTitle;
use Illuminate\Http\Request;

class FrontAboutController extends Controller
{
    public function list(){
        $title = AboutTitle::get(); 

        return view("front.about.list", compact("title"));
    }
}
```

##### 建立前台list.blade頁面

新增後打開原網頁的`about.html`
複製content內容（`End Navigation ~ footer`之間）貼上去
繼承內容打上去
中間各別加上迴圈

```php
@extends("front.comm")
@section("content")

<div data-scroll-watch="" class="fade_in title">
      <div class="breadcrumbs"><a href="/">首頁</a> / <span>關於</span></div>
      <h1 class="top_title">About</h1>
      <div class="top_banner"><img src="/commons/else/img/banner_about.jpg" alt="About Eson"></div>
    </div>
    <div data-scroll-watch="" class="fade_in esontea">
      <section data-scroll-watch="" class="fade_in"><img src="/about/img/.svg">
        <p class="subtitle">
          @foreach($title as $data)
            @if($data->typeId == 1)
              {!! $data->content !!}
              @break
            @endif
          @endforeach
        </p>
      </section>
    </div>
    @foreach($title as $data)
      @continue($data->typeId != 2)
    <div data-scroll-watch="" class="fade_in content_title">
      <h2 class="main_title">{{$data->title}}</h2>
      <div class="subtitle">{!! $data->content !!}</div>
    </div>
    @endforeach
    <div class="idea">
      <section data-scroll-watch="" class="fade_in"><img src="about/img/idea_1.svg">
        <h3 class="main_title">品質穩定</h3>
        <p class="subtitle">與經驗豐富的茶師傅合作</p>
      </section>
    </div>
    @foreach($title as $data)
      @continue($data->typeId != 3)
    <div data-scroll-watch="" class="fade_in content_title">
      <h2 class="main_title">{{$data -> title}}</h2>
      <div class="subtitle">{!! $data->content !!}</div>
    </div>
    @endforeach
    <div class="strength">
      <section data-scroll-watch="" class="fade_in"><img src="about/img/strength_1.jpg">
        <h3 class="main_title">找好茶葉交給找茶專家</h3>
        <p class="subtitle">xx在茶葉界的人脈非常廣闊，熟知不同茶區、茶農、茶商、茶師傅、茶葉包裝行等等，價格相對較優惠。要尋找好茶葉，交給xx就對了！</p>
      </section>
    </div>
    @foreach($title as $data)
      @if($data->typeId == 4)
    <div data-scroll-watch="" class="fade_in content_title">
      <h2 class="main_title">{{ $data -> title}}</h2>
      <div class="subtitle">{!! $data->content !!}</div>
      @break
    </div>
      @endif
    @endforeach
    <div data-scroll-watch="" class="fade_in eson_timeline">
      <div class="col-md-12">
        <div class="main-timeline">
          <div class="timeline">
            <div class="timeline-icon"></div>
            <div class="timeline-content">
              <h2 class="title">2018</h2>
              <p class="description">熟悉茶葉的行家，都知道大禹嶺茶以及其他高山茶類產量非常少。xx主打大禹嶺茶，供應量大，提供顧客安全的選擇。</p>
            </div>
          </div>
          <div class="timeline">
            <div class="timeline-icon"></div>
            <div class="timeline-content right">
              <h2 class="title">2017</h2>
              <p class="description">行銷全球計劃，準備朝向國際品牌的方向邁進！</p>
            </div>
          </div>
        </div>
      </div>
    </div>

@endsection
```

##### 建立/front/about.php路由

```php routes\front\about.php
<?php

use App\Http\Controllers\Front\FrontAboutController AS About;
use Illuminate\Support\Facades\Route;

Route::group(["prefix" => "about"],function(){
    Route::get("/",[About::class, "list"]);
});
```

`index`也要加上去

```php
<?php

require "news.php";
require "about.php";
```

##### 剪貼about的css檔

+ 將原網頁的`css/about`資料夾全部貼到`/public`資料夾下

```php
@if(Request::is("about/*","about"))
<link href="/css/about/about.css" rel="stylesheet">
<!-- about內頁的CSS-->
<link href="/css/about/timeline.css" rel="stylesheet"><!--ScrollWatch滾動淡入-->
@endif
```

將這段加進`comm.blade`的`<head>`
最下面js的部分把`@if (Request::is("news/*","news"))`這段
改到tab的js那邊

```php 會變這樣
<script>
    jQuery(function($) {
        // Plugin activation (basic)
        // $('.to-top').toTop();
        // Plugin activation with options
        $('.to-top').toTop({
            //options with default values
            autohide: true, //boolean 'true' or 'false'
            offset: 250, //numeric value (as pixels) for scrolling length from top to hide automatically
            speed: 650, //numeric value (as mili-seconds) for duration
            right: 20, //numeric value (as pixels) for position from right
            bottom: 60 //numeric value (as pixels) for position from bottom
        });
    });
</script>
<script src="/js/about/ScrollWatch-1.2.0.js"></script>
<!-- ScrollWatch滾動淡入-->
<script>
    (function() {
        var swInstance = new ScrollWatch({});
    })();
</script>
<!-- Tab的JS-->
@if (Request::is("news/*","news"))
<script type="text/javascript">
    $(function() {
        var _showTab = 1;
        var $defaultLi = $('ul.tabs li').eq(_showTab).addClass('active');
        $($defaultLi.find('a').attr('href')).siblings().hide();
        $('ul.tabs li').click(function() {
            var $this = $(this),
                _clickTab = $this.find('a').attr('href');
            $this.addClass('active').siblings('.active').removeClass('active');
            $(_clickTab).stop(false, true).fadeIn().siblings().hide();
            return false;
        }).find('a').focus(function() {
            this.blur();
        });
    });
</script>
@endif
```

##### 建立about_item資料表

{% note info %}
前面的list只是about頁面的框架，內文由type分類
再用item各別裝進去

> 這樣看來資料庫系統其實比較像框架，將各種資料分類
> 像一個大抽屜，裡面放很多格子
> 要調用的時候可以自動化，不用再一個一個手動連結

{% endnote%}

1. 在about_type資料表裡新增items欄位
由於是布林，因此值只要設1（Y/N）

    |名稱|類型|長度/值|Null|備註|
    |:-:|:-:|:-:|:-:|---|
    |items|char|1|O|有無項目|

2. 將`about_type`裡的「關於我們」、「優勢」兩欄位的`items`設為`Y`
3. 在`app\Models\About\AboutType.php`裡`$fillable`新增項目`items`

    ```php
    public $timestamps = false;
    protected $table = "about_type";
    protected $primaryKey = "id";
    protected $fillable = [
        "id",
        "title",
        "items"
    ];
    ```

4. 建立新資料表`about_items`

    | 名稱  | 資料類型 | 長度/值 | Null  |  A.I  | 備註 |
    | :---: | :------: | :-----: | :---: | :---: | ---- |
    |  id   |   int    |    -    |   -   |   O   | -    |
    | typeId | int  |   -    |   O   |   -   | - |
    | itemName | varchar  |   50    |   O   |   -   | - |
    | content | varchar  |   500    |   O   |   -   | - |
    | photo | varchar  |   30    |   O   |   -   | - |

5. 建立新`Model`

    ```terminal
    php artisan make:model About/AboutItem
    ```

    Model內新增內容

    ```php app\Models\About\AboutItem.php
    <?php

    namespace App\Models\About;

    use Illuminate\Database\Eloquent\Factories\HasFactory;
    use Illuminate\Database\Eloquent\Model;
    use Illuminate\Support\Facades\DB;

    class AboutItem extends Model
    {
        public $timestamps = false;
        protected $table = "about_item";
        protected $primaryKey = "id";
        protected $fillable = [
            "id",
            "typeId",
            "itemName",
            "content",
            "photo"
        ];

        public function getList(){
            $item = DB::table("about_item AS a")
                ->selectRaw("a.*, b.title AS typeName")
                ->join("about_type AS b", "a.typeId", "b.id")
                ->get();

            return $item;
        }
    }
    ```